{"ast":null,"code":"import _regeneratorRuntime from \"D:/software_data/Project/Y0527/CODE_BAK/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"D:/software_data/Project/Y0527/CODE_BAK/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.array.flat-map.js\";\nimport \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.array.some.js\";\nimport \"core-js/modules/es.array.unscopables.flat-map.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.flat-map.js\";\nimport \"core-js/modules/es.iterator.some.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.includes.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport { createRouter, createWebHistory } from 'vue-router';\nimport store from '../store';\nimport { ElMessage } from 'element-plus';\nvar routes = [{\n  path: '/',\n  redirect: '/dashboard'\n}, {\n  path: '/login',\n  name: 'Login',\n  component: function component() {\n    return import('../views/Login.vue');\n  },\n  meta: {\n    requiresAuth: false\n  }\n}, {\n  path: '/dashboard',\n  name: 'Dashboard',\n  component: function component() {\n    return import('../views/Dashboard.vue');\n  },\n  meta: {\n    requiresAuth: true,\n    roles: ['admin', 'user']\n  }\n}, {\n  path: '/stations',\n  name: 'Stations',\n  component: function component() {\n    return import('../views/Stations.vue');\n  },\n  meta: {\n    requiresAuth: true,\n    roles: ['admin', 'user']\n  }\n}, {\n  path: '/robots',\n  name: 'Robots',\n  component: function component() {\n    return import('../views/Robots.vue');\n  },\n  meta: {\n    requiresAuth: true,\n    roles: ['admin']\n  }\n}, {\n  path: '/orders',\n  name: 'Orders',\n  component: function component() {\n    return import('../views/Orders.vue');\n  },\n  meta: {\n    requiresAuth: true,\n    roles: ['admin', 'user']\n  }\n}, {\n  path: '/system',\n  name: 'System',\n  component: function component() {\n    return import('../views/System.vue');\n  },\n  meta: {\n    requiresAuth: true,\n    roles: ['admin']\n  }\n}, {\n  path: '/test-api',\n  name: 'TestApi',\n  component: function component() {\n    return import('../views/TestApi.vue');\n  },\n  meta: {\n    requiresAuth: true,\n    roles: ['admin']\n  }\n}, {\n  path: '/energy-efficiency',\n  name: 'EnergyEfficiency',\n  component: function component() {\n    return import('../views/EnergyEfficiency.vue');\n  },\n  meta: {\n    requiresAuth: true,\n    roles: ['admin', 'user']\n  }\n}, {\n  path: '/:pathMatch(.*)*',\n  redirect: '/dashboard'\n}];\nvar router = createRouter({\n  history: createWebHistory(process.env.BASE_URL),\n  routes: routes\n});\n\n// 全局前置守卫\nrouter.beforeEach(/*#__PURE__*/function () {\n  var _ref = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(to, from, next) {\n    var requiresAuth, isAuthenticated, userRole, requiredRoles;\n    return _regeneratorRuntime().wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          // 检查路由是否需要认证\n          requiresAuth = to.matched.some(function (record) {\n            return record.meta.requiresAuth !== false;\n          });\n          if (!requiresAuth) {\n            _context.next = 15;\n            break;\n          }\n          _context.next = 4;\n          return store.dispatch('checkAuth');\n        case 4:\n          isAuthenticated = _context.sent;\n          if (isAuthenticated) {\n            _context.next = 9;\n            break;\n          }\n          // 未登录，重定向到登录页\n          ElMessage.warning('请先登录');\n          next({\n            name: 'Login',\n            query: {\n              redirect: to.fullPath\n            }\n          });\n          return _context.abrupt(\"return\");\n        case 9:\n          // 检查用户角色是否有权限访问\n          userRole = store.getters.userRole;\n          requiredRoles = to.matched.flatMap(function (record) {\n            return record.meta.roles || [];\n          });\n          if (!(requiredRoles.length > 0 && !requiredRoles.includes(userRole))) {\n            _context.next = 15;\n            break;\n          }\n          // 用户角色没有权限访问该路由\n          ElMessage.error('您没有权限访问该页面');\n          next(from.path || '/');\n          return _context.abrupt(\"return\");\n        case 15:\n          if (!(to.name === 'Login' && store.getters.isAuthenticated)) {\n            _context.next = 18;\n            break;\n          }\n          next({\n            path: '/'\n          });\n          return _context.abrupt(\"return\");\n        case 18:\n          next();\n        case 19:\n        case \"end\":\n          return _context.stop();\n      }\n    }, _callee);\n  }));\n  return function (_x, _x2, _x3) {\n    return _ref.apply(this, arguments);\n  };\n}());\nexport default router;","map":{"version":3,"names":["createRouter","createWebHistory","store","ElMessage","routes","path","redirect","name","component","meta","requiresAuth","roles","router","history","process","env","BASE_URL","beforeEach","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","to","from","next","isAuthenticated","userRole","requiredRoles","wrap","_callee$","_context","prev","matched","some","record","dispatch","sent","warning","query","fullPath","abrupt","getters","flatMap","length","includes","error","stop","_x","_x2","_x3","apply","arguments"],"sources":["D:/software_data/Project/Y0527/CODE_BAK/frontend/src/router/index.js"],"sourcesContent":["import { createRouter, createWebHistory } from 'vue-router'\nimport store from '../store'\nimport { ElMessage } from 'element-plus'\n\nconst routes = [\n  {\n    path: '/',\n    redirect: '/dashboard'\n  },\n  {\n    path: '/login',\n    name: 'Login',\n    component: () => import('../views/Login.vue'),\n    meta: { requiresAuth: false }\n  },\n  {\n    path: '/dashboard',\n    name: 'Dashboard',\n    component: () => import('../views/Dashboard.vue'),\n    meta: { \n      requiresAuth: true,\n      roles: ['admin', 'user']\n    }\n  },\n  {\n    path: '/stations',\n    name: 'Stations',\n    component: () => import('../views/Stations.vue'),\n    meta: { \n      requiresAuth: true,\n      roles: ['admin', 'user']\n    }\n  },\n  {\n    path: '/robots',\n    name: 'Robots',\n    component: () => import('../views/Robots.vue'),\n    meta: { \n      requiresAuth: true,\n      roles: ['admin']\n    }\n  },\n  {\n    path: '/orders',\n    name: 'Orders',\n    component: () => import('../views/Orders.vue'),\n    meta: { \n      requiresAuth: true,\n      roles: ['admin', 'user']\n    }\n  },\n  {\n    path: '/system',\n    name: 'System',\n    component: () => import('../views/System.vue'),\n    meta: { \n      requiresAuth: true,\n      roles: ['admin']\n    }\n  },\n  {\n    path: '/test-api',\n    name: 'TestApi',\n    component: () => import('../views/TestApi.vue'),\n    meta: { \n      requiresAuth: true,\n      roles: ['admin']\n    }\n  },\n  {\n    path: '/energy-efficiency',\n    name: 'EnergyEfficiency',\n    component: () => import('../views/EnergyEfficiency.vue'),\n    meta: { \n      requiresAuth: true,\n      roles: ['admin', 'user']\n    }\n  },\n  {\n    path: '/:pathMatch(.*)*',\n    redirect: '/dashboard'\n  }\n]\n\nconst router = createRouter({\n  history: createWebHistory(process.env.BASE_URL),\n  routes\n})\n\n// 全局前置守卫\nrouter.beforeEach(async (to, from, next) => {\n  // 检查路由是否需要认证\n  const requiresAuth = to.matched.some(record => record.meta.requiresAuth !== false)\n  \n  if (requiresAuth) {\n    // 检查用户是否已登录\n    const isAuthenticated = await store.dispatch('checkAuth')\n    \n    if (!isAuthenticated) {\n      // 未登录，重定向到登录页\n      ElMessage.warning('请先登录')\n      next({ name: 'Login', query: { redirect: to.fullPath } })\n      return\n    }\n    \n    // 检查用户角色是否有权限访问\n    const userRole = store.getters.userRole\n    const requiredRoles = to.matched.flatMap(record => record.meta.roles || [])\n    \n    if (requiredRoles.length > 0 && !requiredRoles.includes(userRole)) {\n      // 用户角色没有权限访问该路由\n      ElMessage.error('您没有权限访问该页面')\n      next(from.path || '/')\n      return\n    }\n  }\n  \n  // 用户已登录且访问登录页，重定向到首页\n  if (to.name === 'Login' && store.getters.isAuthenticated) {\n    next({ path: '/' })\n    return\n  }\n  \n  next()\n})\n\nexport default router "],"mappings":";;;;;;;;;;;;;;AAAA,SAASA,YAAY,EAAEC,gBAAgB,QAAQ,YAAY;AAC3D,OAAOC,KAAK,MAAM,UAAU;AAC5B,SAASC,SAAS,QAAQ,cAAc;AAExC,IAAMC,MAAM,GAAG,CACb;EACEC,IAAI,EAAE,GAAG;EACTC,QAAQ,EAAE;AACZ,CAAC,EACD;EACED,IAAI,EAAE,QAAQ;EACdE,IAAI,EAAE,OAAO;EACbC,SAAS,EAAE,SAAXA,SAASA,CAAA;IAAA,OAAQ,MAAM,CAAC,oBAAoB,CAAC;EAAA;EAC7CC,IAAI,EAAE;IAAEC,YAAY,EAAE;EAAM;AAC9B,CAAC,EACD;EACEL,IAAI,EAAE,YAAY;EAClBE,IAAI,EAAE,WAAW;EACjBC,SAAS,EAAE,SAAXA,SAASA,CAAA;IAAA,OAAQ,MAAM,CAAC,wBAAwB,CAAC;EAAA;EACjDC,IAAI,EAAE;IACJC,YAAY,EAAE,IAAI;IAClBC,KAAK,EAAE,CAAC,OAAO,EAAE,MAAM;EACzB;AACF,CAAC,EACD;EACEN,IAAI,EAAE,WAAW;EACjBE,IAAI,EAAE,UAAU;EAChBC,SAAS,EAAE,SAAXA,SAASA,CAAA;IAAA,OAAQ,MAAM,CAAC,uBAAuB,CAAC;EAAA;EAChDC,IAAI,EAAE;IACJC,YAAY,EAAE,IAAI;IAClBC,KAAK,EAAE,CAAC,OAAO,EAAE,MAAM;EACzB;AACF,CAAC,EACD;EACEN,IAAI,EAAE,SAAS;EACfE,IAAI,EAAE,QAAQ;EACdC,SAAS,EAAE,SAAXA,SAASA,CAAA;IAAA,OAAQ,MAAM,CAAC,qBAAqB,CAAC;EAAA;EAC9CC,IAAI,EAAE;IACJC,YAAY,EAAE,IAAI;IAClBC,KAAK,EAAE,CAAC,OAAO;EACjB;AACF,CAAC,EACD;EACEN,IAAI,EAAE,SAAS;EACfE,IAAI,EAAE,QAAQ;EACdC,SAAS,EAAE,SAAXA,SAASA,CAAA;IAAA,OAAQ,MAAM,CAAC,qBAAqB,CAAC;EAAA;EAC9CC,IAAI,EAAE;IACJC,YAAY,EAAE,IAAI;IAClBC,KAAK,EAAE,CAAC,OAAO,EAAE,MAAM;EACzB;AACF,CAAC,EACD;EACEN,IAAI,EAAE,SAAS;EACfE,IAAI,EAAE,QAAQ;EACdC,SAAS,EAAE,SAAXA,SAASA,CAAA;IAAA,OAAQ,MAAM,CAAC,qBAAqB,CAAC;EAAA;EAC9CC,IAAI,EAAE;IACJC,YAAY,EAAE,IAAI;IAClBC,KAAK,EAAE,CAAC,OAAO;EACjB;AACF,CAAC,EACD;EACEN,IAAI,EAAE,WAAW;EACjBE,IAAI,EAAE,SAAS;EACfC,SAAS,EAAE,SAAXA,SAASA,CAAA;IAAA,OAAQ,MAAM,CAAC,sBAAsB,CAAC;EAAA;EAC/CC,IAAI,EAAE;IACJC,YAAY,EAAE,IAAI;IAClBC,KAAK,EAAE,CAAC,OAAO;EACjB;AACF,CAAC,EACD;EACEN,IAAI,EAAE,oBAAoB;EAC1BE,IAAI,EAAE,kBAAkB;EACxBC,SAAS,EAAE,SAAXA,SAASA,CAAA;IAAA,OAAQ,MAAM,CAAC,+BAA+B,CAAC;EAAA;EACxDC,IAAI,EAAE;IACJC,YAAY,EAAE,IAAI;IAClBC,KAAK,EAAE,CAAC,OAAO,EAAE,MAAM;EACzB;AACF,CAAC,EACD;EACEN,IAAI,EAAE,kBAAkB;EACxBC,QAAQ,EAAE;AACZ,CAAC,CACF;AAED,IAAMM,MAAM,GAAGZ,YAAY,CAAC;EAC1Ba,OAAO,EAAEZ,gBAAgB,CAACa,OAAO,CAACC,GAAG,CAACC,QAAQ,CAAC;EAC/CZ,MAAM,EAANA;AACF,CAAC,CAAC;;AAEF;AACAQ,MAAM,CAACK,UAAU;EAAA,IAAAC,IAAA,GAAAC,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAC,SAAAC,QAAOC,EAAE,EAAEC,IAAI,EAAEC,IAAI;IAAA,IAAAf,YAAA,EAAAgB,eAAA,EAAAC,QAAA,EAAAC,aAAA;IAAA,OAAAR,mBAAA,GAAAS,IAAA,UAAAC,SAAAC,QAAA;MAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAN,IAAA;QAAA;UACrC;UACMf,YAAY,GAAGa,EAAE,CAACU,OAAO,CAACC,IAAI,CAAC,UAAAC,MAAM;YAAA,OAAIA,MAAM,CAAC1B,IAAI,CAACC,YAAY,KAAK,KAAK;UAAA,EAAC;UAAA,KAE9EA,YAAY;YAAAqB,QAAA,CAAAN,IAAA;YAAA;UAAA;UAAAM,QAAA,CAAAN,IAAA;UAAA,OAEgBvB,KAAK,CAACkC,QAAQ,CAAC,WAAW,CAAC;QAAA;UAAnDV,eAAe,GAAAK,QAAA,CAAAM,IAAA;UAAA,IAEhBX,eAAe;YAAAK,QAAA,CAAAN,IAAA;YAAA;UAAA;UAClB;UACAtB,SAAS,CAACmC,OAAO,CAAC,MAAM,CAAC;UACzBb,IAAI,CAAC;YAAElB,IAAI,EAAE,OAAO;YAAEgC,KAAK,EAAE;cAAEjC,QAAQ,EAAEiB,EAAE,CAACiB;YAAS;UAAE,CAAC,CAAC;UAAA,OAAAT,QAAA,CAAAU,MAAA;QAAA;UAI3D;UACMd,QAAQ,GAAGzB,KAAK,CAACwC,OAAO,CAACf,QAAQ;UACjCC,aAAa,GAAGL,EAAE,CAACU,OAAO,CAACU,OAAO,CAAC,UAAAR,MAAM;YAAA,OAAIA,MAAM,CAAC1B,IAAI,CAACE,KAAK,IAAI,EAAE;UAAA,EAAC;UAAA,MAEvEiB,aAAa,CAACgB,MAAM,GAAG,CAAC,IAAI,CAAChB,aAAa,CAACiB,QAAQ,CAAClB,QAAQ,CAAC;YAAAI,QAAA,CAAAN,IAAA;YAAA;UAAA;UAC/D;UACAtB,SAAS,CAAC2C,KAAK,CAAC,YAAY,CAAC;UAC7BrB,IAAI,CAACD,IAAI,CAACnB,IAAI,IAAI,GAAG,CAAC;UAAA,OAAA0B,QAAA,CAAAU,MAAA;QAAA;UAAA,MAMtBlB,EAAE,CAAChB,IAAI,KAAK,OAAO,IAAIL,KAAK,CAACwC,OAAO,CAAChB,eAAe;YAAAK,QAAA,CAAAN,IAAA;YAAA;UAAA;UACtDA,IAAI,CAAC;YAAEpB,IAAI,EAAE;UAAI,CAAC,CAAC;UAAA,OAAA0B,QAAA,CAAAU,MAAA;QAAA;UAIrBhB,IAAI,CAAC,CAAC;QAAA;QAAA;UAAA,OAAAM,QAAA,CAAAgB,IAAA;MAAA;IAAA,GAAAzB,OAAA;EAAA,CACP;EAAA,iBAAA0B,EAAA,EAAAC,GAAA,EAAAC,GAAA;IAAA,OAAAhC,IAAA,CAAAiC,KAAA,OAAAC,SAAA;EAAA;AAAA,IAAC;AAEF,eAAexC,MAAM","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}