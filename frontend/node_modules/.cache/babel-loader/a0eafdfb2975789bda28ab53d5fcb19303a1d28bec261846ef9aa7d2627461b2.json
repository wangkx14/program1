{"ast":null,"code":"import _regeneratorRuntime from \"D:/software_data/Project/Y0527/CODE_BAK/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"D:/software_data/Project/Y0527/CODE_BAK/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.error.cause.js\";\nimport \"core-js/modules/es.error.to-string.js\";\nimport \"core-js/modules/es.date.to-json.js\";\nimport \"core-js/modules/es.json.stringify.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport { createStore } from 'vuex';\nimport axios from 'axios';\nvar API_URL = process.env.VUE_APP_API_URL || 'http://localhost:5000';\nexport default createStore({\n  state: {\n    user: JSON.parse(localStorage.getItem('user')) || null,\n    token: localStorage.getItem('token') || null\n  },\n  mutations: {\n    setUser: function setUser(state, user) {\n      state.user = user;\n      localStorage.setItem('user', JSON.stringify(user));\n    },\n    setToken: function setToken(state, token) {\n      state.token = token;\n      localStorage.setItem('token', token);\n    },\n    clearUser: function clearUser(state) {\n      state.user = null;\n      state.token = null;\n      localStorage.removeItem('user');\n      localStorage.removeItem('token');\n    }\n  },\n  actions: {\n    login: function login(_ref, _ref2) {\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var commit, username, password, response, _response$data, user, access_token, _error$response;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              commit = _ref.commit;\n              username = _ref2.username, password = _ref2.password;\n              _context.prev = 2;\n              _context.next = 5;\n              return axios.post(\"\".concat(API_URL, \"/api/auth/login\"), {\n                username: username,\n                password: password\n              });\n            case 5:\n              response = _context.sent;\n              _response$data = response.data, user = _response$data.user, access_token = _response$data.access_token;\n              commit('setUser', user);\n              commit('setToken', access_token);\n              return _context.abrupt(\"return\", user);\n            case 12:\n              _context.prev = 12;\n              _context.t0 = _context[\"catch\"](2);\n              console.error('Login failed:', _context.t0.response || _context.t0);\n              throw new Error(((_error$response = _context.t0.response) === null || _error$response === void 0 || (_error$response = _error$response.data) === null || _error$response === void 0 ? void 0 : _error$response.error) || _context.t0.message || '登录失败，请检查网络连接');\n            case 16:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, null, [[2, 12]]);\n      }))();\n    },\n    logout: function logout(_ref3) {\n      var commit = _ref3.commit;\n      commit('clearUser');\n    },\n    checkAuth: function checkAuth(_ref4) {\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var state, commit, response;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              state = _ref4.state, commit = _ref4.commit;\n              if (!(state.token && !state.user)) {\n                _context2.next = 15;\n                break;\n              }\n              _context2.prev = 2;\n              _context2.next = 5;\n              return axios.get(\"\".concat(API_URL, \"/api/auth/me\"), {\n                headers: {\n                  Authorization: \"Bearer \".concat(state.token)\n                }\n              });\n            case 5:\n              response = _context2.sent;\n              commit('setUser', response.data);\n              return _context2.abrupt(\"return\", true);\n            case 10:\n              _context2.prev = 10;\n              _context2.t0 = _context2[\"catch\"](2);\n              console.error('获取用户信息失败:', _context2.t0);\n              commit('clearUser');\n              return _context2.abrupt(\"return\", false);\n            case 15:\n              return _context2.abrupt(\"return\", !!state.token);\n            case 16:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, null, [[2, 10]]);\n      }))();\n    }\n  },\n  getters: {\n    isAuthenticated: function isAuthenticated(state) {\n      return !!state.token;\n    },\n    currentUser: function currentUser(state) {\n      return state.user;\n    },\n    isAdmin: function isAdmin(state) {\n      var _state$user;\n      return ((_state$user = state.user) === null || _state$user === void 0 ? void 0 : _state$user.role) === 'admin';\n    },\n    userRole: function userRole(state) {\n      var _state$user2;\n      return ((_state$user2 = state.user) === null || _state$user2 === void 0 ? void 0 : _state$user2.role) || '';\n    }\n  }\n});","map":{"version":3,"names":["createStore","axios","API_URL","process","env","VUE_APP_API_URL","state","user","JSON","parse","localStorage","getItem","token","mutations","setUser","setItem","stringify","setToken","clearUser","removeItem","actions","login","_ref","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","commit","username","password","response","_response$data","access_token","_error$response","wrap","_callee$","_context","prev","next","post","concat","sent","data","abrupt","t0","console","error","Error","message","stop","logout","_ref3","checkAuth","_ref4","_callee2","_callee2$","_context2","get","headers","Authorization","getters","isAuthenticated","currentUser","isAdmin","_state$user","role","userRole","_state$user2"],"sources":["D:/software_data/Project/Y0527/CODE_BAK/frontend/src/store/index.js"],"sourcesContent":["import { createStore } from 'vuex'\nimport axios from 'axios'\n\nconst API_URL = process.env.VUE_APP_API_URL || 'http://localhost:5000'\n\nexport default createStore({\n  state: {\n    user: JSON.parse(localStorage.getItem('user')) || null,\n    token: localStorage.getItem('token') || null\n  },\n  mutations: {\n    setUser(state, user) {\n      state.user = user\n      localStorage.setItem('user', JSON.stringify(user))\n    },\n    setToken(state, token) {\n      state.token = token\n      localStorage.setItem('token', token)\n    },\n    clearUser(state) {\n      state.user = null\n      state.token = null\n      localStorage.removeItem('user')\n      localStorage.removeItem('token')\n    }\n  },\n  actions: {\n    async login({ commit }, { username, password }) {\n      try {\n        const response = await axios.post(`${API_URL}/api/auth/login`, {\n          username,\n          password\n        })\n        \n        const { user, access_token } = response.data\n        \n        commit('setUser', user)\n        commit('setToken', access_token)\n        \n        return user\n      } catch (error) {\n        console.error('Login failed:', error.response || error)\n        throw new Error(\n          error.response?.data?.error || \n          error.message || \n          '登录失败，请检查网络连接'\n        )\n      }\n    },\n    logout({ commit }) {\n      commit('clearUser')\n    },\n    async checkAuth({ state, commit }) {\n      // 如果本地有token但没有用户信息，尝试获取用户信息\n      if (state.token && !state.user) {\n        try {\n          const response = await axios.get(`${API_URL}/api/auth/me`, {\n            headers: {\n              Authorization: `Bearer ${state.token}`\n            }\n          })\n          commit('setUser', response.data)\n          return true\n        } catch (error) {\n          console.error('获取用户信息失败:', error)\n          commit('clearUser')\n          return false\n        }\n      }\n      return !!state.token\n    }\n  },\n  getters: {\n    isAuthenticated: state => !!state.token,\n    currentUser: state => state.user,\n    isAdmin: state => state.user?.role === 'admin',\n    userRole: state => state.user?.role || ''\n  }\n}) "],"mappings":";;;;;;;AAAA,SAASA,WAAW,QAAQ,MAAM;AAClC,OAAOC,KAAK,MAAM,OAAO;AAEzB,IAAMC,OAAO,GAAGC,OAAO,CAACC,GAAG,CAACC,eAAe,IAAI,uBAAuB;AAEtE,eAAeL,WAAW,CAAC;EACzBM,KAAK,EAAE;IACLC,IAAI,EAAEC,IAAI,CAACC,KAAK,CAACC,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC,CAAC,IAAI,IAAI;IACtDC,KAAK,EAAEF,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,IAAI;EAC1C,CAAC;EACDE,SAAS,EAAE;IACTC,OAAO,WAAPA,OAAOA,CAACR,KAAK,EAAEC,IAAI,EAAE;MACnBD,KAAK,CAACC,IAAI,GAAGA,IAAI;MACjBG,YAAY,CAACK,OAAO,CAAC,MAAM,EAAEP,IAAI,CAACQ,SAAS,CAACT,IAAI,CAAC,CAAC;IACpD,CAAC;IACDU,QAAQ,WAARA,QAAQA,CAACX,KAAK,EAAEM,KAAK,EAAE;MACrBN,KAAK,CAACM,KAAK,GAAGA,KAAK;MACnBF,YAAY,CAACK,OAAO,CAAC,OAAO,EAAEH,KAAK,CAAC;IACtC,CAAC;IACDM,SAAS,WAATA,SAASA,CAACZ,KAAK,EAAE;MACfA,KAAK,CAACC,IAAI,GAAG,IAAI;MACjBD,KAAK,CAACM,KAAK,GAAG,IAAI;MAClBF,YAAY,CAACS,UAAU,CAAC,MAAM,CAAC;MAC/BT,YAAY,CAACS,UAAU,CAAC,OAAO,CAAC;IAClC;EACF,CAAC;EACDC,OAAO,EAAE;IACDC,KAAK,WAALA,KAAKA,CAAAC,IAAA,EAAAC,KAAA,EAAqC;MAAA,OAAAC,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,UAAAC,QAAA;QAAA,IAAAC,MAAA,EAAAC,QAAA,EAAAC,QAAA,EAAAC,QAAA,EAAAC,cAAA,EAAAzB,IAAA,EAAA0B,YAAA,EAAAC,eAAA;QAAA,OAAAT,mBAAA,GAAAU,IAAA,UAAAC,SAAAC,QAAA;UAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;YAAA;cAAlCX,MAAM,GAAAN,IAAA,CAANM,MAAM;cAAMC,QAAQ,GAAAN,KAAA,CAARM,QAAQ,EAAEC,QAAQ,GAAAP,KAAA,CAARO,QAAQ;cAAAO,QAAA,CAAAC,IAAA;cAAAD,QAAA,CAAAE,IAAA;cAAA,OAEjBtC,KAAK,CAACuC,IAAI,IAAAC,MAAA,CAAIvC,OAAO,sBAAmB;gBAC7D2B,QAAQ,EAARA,QAAQ;gBACRC,QAAQ,EAARA;cACF,CAAC,CAAC;YAAA;cAHIC,QAAQ,GAAAM,QAAA,CAAAK,IAAA;cAAAV,cAAA,GAKiBD,QAAQ,CAACY,IAAI,EAApCpC,IAAI,GAAAyB,cAAA,CAAJzB,IAAI,EAAE0B,YAAY,GAAAD,cAAA,CAAZC,YAAY;cAE1BL,MAAM,CAAC,SAAS,EAAErB,IAAI,CAAC;cACvBqB,MAAM,CAAC,UAAU,EAAEK,YAAY,CAAC;cAAA,OAAAI,QAAA,CAAAO,MAAA,WAEzBrC,IAAI;YAAA;cAAA8B,QAAA,CAAAC,IAAA;cAAAD,QAAA,CAAAQ,EAAA,GAAAR,QAAA;cAEXS,OAAO,CAACC,KAAK,CAAC,eAAe,EAAEV,QAAA,CAAAQ,EAAA,CAAMd,QAAQ,IAAAM,QAAA,CAAAQ,EAAS,CAAC;cAAA,MACjD,IAAIG,KAAK,CACb,EAAAd,eAAA,GAAAG,QAAA,CAAAQ,EAAA,CAAMd,QAAQ,cAAAG,eAAA,gBAAAA,eAAA,GAAdA,eAAA,CAAgBS,IAAI,cAAAT,eAAA,uBAApBA,eAAA,CAAsBa,KAAK,KAC3BV,QAAA,CAAAQ,EAAA,CAAMI,OAAO,IACb,cACF,CAAC;YAAA;YAAA;cAAA,OAAAZ,QAAA,CAAAa,IAAA;UAAA;QAAA,GAAAvB,OAAA;MAAA;IAEL,CAAC;IACDwB,MAAM,WAANA,MAAMA,CAAAC,KAAA,EAAa;MAAA,IAAVxB,MAAM,GAAAwB,KAAA,CAANxB,MAAM;MACbA,MAAM,CAAC,WAAW,CAAC;IACrB,CAAC;IACKyB,SAAS,WAATA,SAASA,CAAAC,KAAA,EAAoB;MAAA,OAAA9B,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,UAAA6B,SAAA;QAAA,IAAAjD,KAAA,EAAAsB,MAAA,EAAAG,QAAA;QAAA,OAAAN,mBAAA,GAAAU,IAAA,UAAAqB,UAAAC,SAAA;UAAA,kBAAAA,SAAA,CAAAnB,IAAA,GAAAmB,SAAA,CAAAlB,IAAA;YAAA;cAAjBjC,KAAK,GAAAgD,KAAA,CAALhD,KAAK,EAAEsB,MAAM,GAAA0B,KAAA,CAAN1B,MAAM;cAAA,MAEzBtB,KAAK,CAACM,KAAK,IAAI,CAACN,KAAK,CAACC,IAAI;gBAAAkD,SAAA,CAAAlB,IAAA;gBAAA;cAAA;cAAAkB,SAAA,CAAAnB,IAAA;cAAAmB,SAAA,CAAAlB,IAAA;cAAA,OAEHtC,KAAK,CAACyD,GAAG,IAAAjB,MAAA,CAAIvC,OAAO,mBAAgB;gBACzDyD,OAAO,EAAE;kBACPC,aAAa,YAAAnB,MAAA,CAAYnC,KAAK,CAACM,KAAK;gBACtC;cACF,CAAC,CAAC;YAAA;cAJImB,QAAQ,GAAA0B,SAAA,CAAAf,IAAA;cAKdd,MAAM,CAAC,SAAS,EAAEG,QAAQ,CAACY,IAAI,CAAC;cAAA,OAAAc,SAAA,CAAAb,MAAA,WACzB,IAAI;YAAA;cAAAa,SAAA,CAAAnB,IAAA;cAAAmB,SAAA,CAAAZ,EAAA,GAAAY,SAAA;cAEXX,OAAO,CAACC,KAAK,CAAC,WAAW,EAAAU,SAAA,CAAAZ,EAAO,CAAC;cACjCjB,MAAM,CAAC,WAAW,CAAC;cAAA,OAAA6B,SAAA,CAAAb,MAAA,WACZ,KAAK;YAAA;cAAA,OAAAa,SAAA,CAAAb,MAAA,WAGT,CAAC,CAACtC,KAAK,CAACM,KAAK;YAAA;YAAA;cAAA,OAAA6C,SAAA,CAAAP,IAAA;UAAA;QAAA,GAAAK,QAAA;MAAA;IACtB;EACF,CAAC;EACDM,OAAO,EAAE;IACPC,eAAe,EAAE,SAAjBA,eAAeA,CAAExD,KAAK;MAAA,OAAI,CAAC,CAACA,KAAK,CAACM,KAAK;IAAA;IACvCmD,WAAW,EAAE,SAAbA,WAAWA,CAAEzD,KAAK;MAAA,OAAIA,KAAK,CAACC,IAAI;IAAA;IAChCyD,OAAO,EAAE,SAATA,OAAOA,CAAE1D,KAAK;MAAA,IAAA2D,WAAA;MAAA,OAAI,EAAAA,WAAA,GAAA3D,KAAK,CAACC,IAAI,cAAA0D,WAAA,uBAAVA,WAAA,CAAYC,IAAI,MAAK,OAAO;IAAA;IAC9CC,QAAQ,EAAE,SAAVA,QAAQA,CAAE7D,KAAK;MAAA,IAAA8D,YAAA;MAAA,OAAI,EAAAA,YAAA,GAAA9D,KAAK,CAACC,IAAI,cAAA6D,YAAA,uBAAVA,YAAA,CAAYF,IAAI,KAAI,EAAE;IAAA;EAC3C;AACF,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}