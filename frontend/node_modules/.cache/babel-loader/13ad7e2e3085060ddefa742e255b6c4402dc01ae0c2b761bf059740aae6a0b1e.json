{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/jiaronghao/Desktop/Documents/\\u672C\\u79D1\\u8BBA\\u6587\\u7F16\\u5199/5\\u3001\\u7A0B\\u5E8F\\u7F16\\u5199/Y0527-final/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"C:/Users/jiaronghao/Desktop/Documents/\\u672C\\u79D1\\u8BBA\\u6587\\u7F16\\u5199/5\\u3001\\u7A0B\\u5E8F\\u7F16\\u5199/Y0527-final/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.error.cause.js\";\nimport \"core-js/modules/es.error.to-string.js\";\nimport \"core-js/modules/es.date.to-json.js\";\nimport \"core-js/modules/es.json.stringify.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport { createStore } from 'vuex';\nimport axios from 'axios';\nvar API_URL = process.env.VUE_APP_API_URL || 'http://localhost:5000';\nexport default createStore({\n  state: {\n    user: JSON.parse(localStorage.getItem('user')) || null,\n    token: localStorage.getItem('token') || null\n  },\n  mutations: {\n    setUser: function setUser(state, user) {\n      state.user = user;\n      localStorage.setItem('user', JSON.stringify(user));\n    },\n    setToken: function setToken(state, token) {\n      state.token = token;\n      localStorage.setItem('token', token);\n    },\n    clearUser: function clearUser(state) {\n      state.user = null;\n      state.token = null;\n      localStorage.removeItem('user');\n      localStorage.removeItem('token');\n    }\n  },\n  actions: {\n    login: function login(_ref, _ref2) {\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var commit, username, password, response, _response$data, user, access_token, _error$response;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              commit = _ref.commit;\n              username = _ref2.username, password = _ref2.password;\n              _context.prev = 2;\n              console.log('尝试登录:', {\n                username: username\n              });\n              _context.next = 6;\n              return axios.post(\"\".concat(API_URL, \"/api/auth/login\"), {\n                username: username,\n                password: password\n              });\n            case 6:\n              response = _context.sent;\n              _response$data = response.data, user = _response$data.user, access_token = _response$data.access_token;\n              console.log('登录成功，获取到token和用户信息:', {\n                user: user,\n                token_length: access_token === null || access_token === void 0 ? void 0 : access_token.length\n              });\n              commit('setUser', user);\n              commit('setToken', access_token);\n\n              // 添加默认认证头\n              axios.defaults.headers.common['Authorization'] = \"Bearer \".concat(access_token);\n              return _context.abrupt(\"return\", user);\n            case 15:\n              _context.prev = 15;\n              _context.t0 = _context[\"catch\"](2);\n              console.error('Login failed:', _context.t0.response || _context.t0);\n              throw new Error(((_error$response = _context.t0.response) === null || _error$response === void 0 || (_error$response = _error$response.data) === null || _error$response === void 0 ? void 0 : _error$response.error) || _context.t0.message || '登录失败，请检查网络连接');\n            case 19:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, null, [[2, 15]]);\n      }))();\n    },\n    logout: function logout(_ref3) {\n      var commit = _ref3.commit;\n      // 移除默认认证头\n      delete axios.defaults.headers.common['Authorization'];\n      commit('clearUser');\n    },\n    checkAuth: function checkAuth(_ref4) {\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var state, commit, response;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              state = _ref4.state, commit = _ref4.commit;\n              if (!(state.token && !state.user)) {\n                _context2.next = 18;\n                break;\n              }\n              _context2.prev = 2;\n              console.log('尝试使用token获取用户信息');\n\n              // 设置认证头\n              axios.defaults.headers.common['Authorization'] = \"Bearer \".concat(state.token);\n              _context2.next = 7;\n              return axios.get(\"\".concat(API_URL, \"/api/auth/me\"), {\n                headers: {\n                  Authorization: \"Bearer \".concat(state.token)\n                }\n              });\n            case 7:\n              response = _context2.sent;\n              commit('setUser', response.data);\n              return _context2.abrupt(\"return\", true);\n            case 12:\n              _context2.prev = 12;\n              _context2.t0 = _context2[\"catch\"](2);\n              console.error('获取用户信息失败:', _context2.t0);\n              // 移除默认认证头\n              delete axios.defaults.headers.common['Authorization'];\n              commit('clearUser');\n              return _context2.abrupt(\"return\", false);\n            case 18:\n              // 如果有token，设置默认认证头\n              if (state.token) {\n                axios.defaults.headers.common['Authorization'] = \"Bearer \".concat(state.token);\n              }\n              return _context2.abrupt(\"return\", !!state.token);\n            case 20:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, null, [[2, 12]]);\n      }))();\n    }\n  },\n  getters: {\n    isAuthenticated: function isAuthenticated(state) {\n      return !!state.token;\n    },\n    currentUser: function currentUser(state) {\n      return state.user;\n    },\n    isAdmin: function isAdmin(state) {\n      var _state$user;\n      return ((_state$user = state.user) === null || _state$user === void 0 ? void 0 : _state$user.role) === 'admin';\n    },\n    userRole: function userRole(state) {\n      var _state$user2;\n      return ((_state$user2 = state.user) === null || _state$user2 === void 0 ? void 0 : _state$user2.role) || '';\n    }\n  }\n});","map":{"version":3,"names":["createStore","axios","API_URL","process","env","VUE_APP_API_URL","state","user","JSON","parse","localStorage","getItem","token","mutations","setUser","setItem","stringify","setToken","clearUser","removeItem","actions","login","_ref","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","commit","username","password","response","_response$data","access_token","_error$response","wrap","_callee$","_context","prev","next","console","log","post","concat","sent","data","token_length","length","defaults","headers","common","abrupt","t0","error","Error","message","stop","logout","_ref3","checkAuth","_ref4","_callee2","_callee2$","_context2","get","Authorization","getters","isAuthenticated","currentUser","isAdmin","_state$user","role","userRole","_state$user2"],"sources":["C:/Users/jiaronghao/Desktop/Documents/本科论文编写/5、程序编写/Y0527-final/frontend/src/store/index.js"],"sourcesContent":["import { createStore } from 'vuex'\nimport axios from 'axios'\n\nconst API_URL = process.env.VUE_APP_API_URL || 'http://localhost:5000'\n\nexport default createStore({\n  state: {\n    user: JSON.parse(localStorage.getItem('user')) || null,\n    token: localStorage.getItem('token') || null\n  },\n  mutations: {\n    setUser(state, user) {\n      state.user = user\n      localStorage.setItem('user', JSON.stringify(user))\n    },\n    setToken(state, token) {\n      state.token = token\n      localStorage.setItem('token', token)\n    },\n    clearUser(state) {\n      state.user = null\n      state.token = null\n      localStorage.removeItem('user')\n      localStorage.removeItem('token')\n    }\n  },\n  actions: {\n    async login({ commit }, { username, password }) {\n      try {\n        console.log('尝试登录:', { username })\n        \n        const response = await axios.post(`${API_URL}/api/auth/login`, {\n          username,\n          password\n        })\n        \n        const { user, access_token } = response.data\n        console.log('登录成功，获取到token和用户信息:', { user, token_length: access_token?.length })\n        \n        commit('setUser', user)\n        commit('setToken', access_token)\n        \n        // 添加默认认证头\n        axios.defaults.headers.common['Authorization'] = `Bearer ${access_token}`\n        \n        return user\n      } catch (error) {\n        console.error('Login failed:', error.response || error)\n        throw new Error(\n          error.response?.data?.error || \n          error.message || \n          '登录失败，请检查网络连接'\n        )\n      }\n    },\n    logout({ commit }) {\n      // 移除默认认证头\n      delete axios.defaults.headers.common['Authorization']\n      commit('clearUser')\n    },\n    async checkAuth({ state, commit }) {\n      // 如果本地有token但没有用户信息，尝试获取用户信息\n      if (state.token && !state.user) {\n        try {\n          console.log('尝试使用token获取用户信息')\n          \n          // 设置认证头\n          axios.defaults.headers.common['Authorization'] = `Bearer ${state.token}`\n          \n          const response = await axios.get(`${API_URL}/api/auth/me`, {\n            headers: {\n              Authorization: `Bearer ${state.token}`\n            }\n          })\n          commit('setUser', response.data)\n          return true\n        } catch (error) {\n          console.error('获取用户信息失败:', error)\n          // 移除默认认证头\n          delete axios.defaults.headers.common['Authorization']\n          commit('clearUser')\n          return false\n        }\n      }\n      \n      // 如果有token，设置默认认证头\n      if (state.token) {\n        axios.defaults.headers.common['Authorization'] = `Bearer ${state.token}`\n      }\n      \n      return !!state.token\n    }\n  },\n  getters: {\n    isAuthenticated: state => !!state.token,\n    currentUser: state => state.user,\n    isAdmin: state => state.user?.role === 'admin',\n    userRole: state => state.user?.role || ''\n  }\n}) "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}